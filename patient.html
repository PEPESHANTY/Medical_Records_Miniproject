<html>
  <head>
    <title>Register Patient</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/hospital.css" />
  </head>
  <body>
    <nav class="navbar">
      <a href="doctor.html"
        ><button
          class="page__buttons"
          class="hidden"
          style="margin-right: 16px"
        >
          Doctor Registration
        </button></a
      ><a href="patient.html"
        ><button
          class="page__buttons"
          class="hidden"
          style="margin-right: 16px"
        >
          Patient Registration
        </button></a
      ><a href="patient_details.html"
        ><button
          class="page__buttons"
          class="hidden"
          style="margin-right: 16px"
        >
          View Patient Details
        </button></a
      ><a href="record_details.html"
        ><button
          class="page__buttons"
          class="hidden"
          style="margin-right: 16px"
        >
          View Medical Record
        </button></a
      ><a href="examine_details.html"
        ><button
          class="page__buttons"
          class="hidden"
          style="margin-right: 16px"
        >
          View Patient Examine details
        </button></a
      >
    </nav>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.2.8/dist/web3.js"></script>
    <script>
      var account;
      window.addEventListener("load", async () => {
        if (typeof window.ethereum !== "undefined") {
          console.log("MetaMask is Available :) !");
        }

        // Modern DApp browsers
        if (window.ethereum) {
          window.web3 = new Web3(ethereum);

          // To prevent the page reloading when the MetaMask network changes
          ethereum.autoRefreshOnNetworkChange = false;

          // To Capture the account details from MetaMask
          const accounts = await ethereum.enable();
          account = accounts[0];
        }
        // Legacy DApp browsers
        else if (window.web3) {
          //window.web3 = new Web3(web3.currentProvider);
          window.web3 = new Web3(
            new Web3.providers.HttpProvider(
              "https://mainnet.infura.io/v3/88f2325f3b7c4cffa32451f99767f4e7"
            )
          );
        }
        // Non-DApp browsers
        else {
          console.log("Non-Ethereum browser detected. Please install MetaMask");
        }
      });

      var abi = [
        {
          inputs: [],
          stateMutability: "nonpayable",
          type: "constructor",
        },
        {
          inputs: [
            {
              internalType: "uint256",
              name: "patient_id",
              type: "uint256",
            },
          ],
          name: "retreive_attendant_details",
          outputs: [
            {
              internalType: "string",
              name: "",
              type: "string",
            },
            {
              internalType: "string",
              name: "",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "",
              type: "uint256",
            },
          ],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "uint256",
              name: "patient_id",
              type: "uint256",
            },
          ],
          name: "retreive_patient_details",
          outputs: [
            {
              internalType: "string",
              name: "",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "",
              type: "uint256",
            },
            {
              internalType: "string",
              name: "",
              type: "string",
            },
            {
              internalType: "string",
              name: "",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "",
              type: "uint256",
            },
            {
              internalType: "string",
              name: "",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "",
              type: "uint256",
            },
            {
              internalType: "string",
              name: "",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "",
              type: "uint256",
            },
          ],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "uint256",
              name: "patient_id",
              type: "uint256",
            },
            {
              internalType: "string",
              name: "_attendant_name",
              type: "string",
            },
            {
              internalType: "string",
              name: "_attendant_relation",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "_attendant_phn_no",
              type: "uint256",
            },
          ],
          name: "store_attendant_details",
          outputs: [],
          stateMutability: "nonpayable",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "uint256",
              name: "patient_id",
              type: "uint256",
            },
            {
              internalType: "string",
              name: "_patient_name",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "_age",
              type: "uint256",
            },
            {
              internalType: "string",
              name: "_gender",
              type: "string",
            },
            {
              internalType: "string",
              name: "_height",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "_weight",
              type: "uint256",
            },
            {
              internalType: "string",
              name: "_patient_address",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "_phone_no",
              type: "uint256",
            },
            {
              internalType: "string",
              name: "_email_id",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "_date",
              type: "uint256",
            },
          ],
          name: "store_patient_details",
          outputs: [],
          stateMutability: "nonpayable",
          type: "function",
        },
      ];
      var contractaddress = "0x8d81cfbfef1fd1de08cbbc2e4c96b0bd0f12e7b6";

      function add_details() {
        var myContract = new web3.eth.Contract(abi, contractaddress, {
          from: account,
        });
        var ds1 = document.getElementById("age").value;
        var ds2 = document.getElementById("gen").value;
        var ds3 = document.getElementById("hght").value;
        var ds4 = document.getElementById("weig").value;
        var ds5 = document.getElementById("addr").value;
        var ds6 = document.getElementById("pno").value;
        var ds7 = document.getElementById("email").value;
        var ds8 = document.getElementById("date").value;
        var tname = document.getElementById("name1").value;
        var id = document.getElementById("id1").value;
        var ads1 = document.getElementById("rel").value;
        var ads2 = document.getElementById("apno").value;
        var aname = document.getElementById("aname1").value;
        var aid = document.getElementById("id2").value;
        var result = myContract.methods
          .store_patient_details(
            id,
            tname,
            ds1,
            ds2,
            ds3,
            ds4,
            ds5,
            ds6,
            ds7,
            ds8
          )
          .send(function (err, result) {
            if (err) {
              console.log(err);
            }
          });

        var result = myContract.methods
          .store_attendant_details(aid, aname, ads1, ads2)
          .send(function (err, result) {
            if (err) {
              console.log(err);
            }
          });
      }
    </script>
    <div class="container">
      <h1 class="heading__1">Patient Registration</h1>
      <h2 class="heading__2">Register Patient</h2>
      <form class="patient__register__form">
        <div class="form__div">
          <lable class="input__labels">Enter Patient Id:</lable>
          <input class="inputs" type="text" id="id1" name="id1" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Patient Name:</lable>
          <input class="inputs" type="text" id="name1" name="name1" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Age:</lable>
          <input class="inputs" type="text" id="age" name="age" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Gender:</lable>
          <input class="inputs" type="text" id="gen" name="gen" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Height(in ft):</lable>
          <input class="inputs" type="text" id="hght" name="hght" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Weight(in kg):</lable>
          <input class="inputs" type="text" id="weig" name="weig" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Address:</lable>
          <input class="inputs" type="text" id="addr" name="addr" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Phone Number:</lable>
          <input class="inputs" type="text" id="pno" name="pno" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Email Id:</lable>
          <input class="inputs" type="text" id="email" name="email" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Date:</lable>
          <input class="inputs" type="text" id="date" name="date" />
        </div>

        <h2 class="heading__2">Patient's Attendant Details</h2>

        <div class="form__div">
          <lable class="input__labels">Enter Patient Id:</lable>
          <input class="inputs" type="text" id="id2" name="id2" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Attendant Name:</lable>
          <input class="inputs" type="text" id="aname1" name="aname1" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Attendant Relation:</lable>
          <input class="inputs" type="text" id="rel" name="rel" />
        </div>
        <div class="form__div">
          <lable class="input__labels">Phone Number:</lable>
          <input class="inputs" type="text" id="apno" name="apno" />
        </div>

        <input
          class="submit__button"
          type="button"
          onclick="add_details()"
          value="Register"
        />
      </form>

      <h3 class="heading__3">
        To get details of a patient
        <a href="patient_details.html">Click Here</a>
      </h3>
    </div>
  </body>
</html>
